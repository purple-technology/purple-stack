[tools]
nodejs = '22.19.0'
pnpm = '10.17.0'
[env]
AWS_REGION = 'eu-central-1'
_.source = 'scripts/set_sst_stage.sh'

[tasks.aws-sso-check]
description = 'Check AWS SSO login status'
run = 'bash scripts/aws_sso.sh'

[tasks."sst deploy"]
alias = 'sstdep'
description = 'Deploy using SST (with AWS SSO check and branch-based stage)'
run = [
  'pnpm sst deploy'
]
depends = ['aws-sso-check']

[tasks."sst dev"]
alias = 'sstdev'
description = 'Run SST in dev mode - locally'
run = [
  'pnpm sst dev'
]
depends = ['aws-sso-check']

[tasks."sst remove"]
alias = 'sstrem'
description = 'Remove SST stack (with AWS SSO check and branch-based stage)'
run = [
  'pnpm sst remove'
]
depends = ['aws-sso-check']

[tasks."lint"]
alias = 'lt'
description = 'Runs Biome lint + formatter check'
run = [
    'pnpm run lint'
]

[tasks."lint:fix"]
alias = 'ltf'
description = 'Runs Biome lint + formatter fix'
run = [
    'pnpm run lint:fix'
]

[tasks."trpc:panel"]
alias = 'trpn'
description = 'Starts tRPC local UI/Panel'
dir = 'packages/trpc-api'
run = [
    'pnpm tsx src/trpcUi.ts'
]

[tasks."typecheck"]
alias = 'tc'
description = 'Run TypeScript type checking for the entire monorepo'
run = [
    'pnpm run -r typecheck'
]

[tasks."test"]
alias = 'tst'
description = 'Run tests for the entire monorepo'
run = [
    'pnpm run test'
]

[tasks."check"]
alias = 'chk'
description = 'Run lint fix, typecheck, and tests - full quality check'
run = [
    'pnpm run lint:fix',
    'pnpm run typecheck',
    'pnpm run test'
]
